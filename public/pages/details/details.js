app.controller("DetailsCtrl", function ($scope, $http, $routeParams, $location) {
    var recipeId = $routeParams.recipeId;
    var params = {
        _app_id: "6e96cfda",
        _app_key: "555f5bd10dffba7229ea6a9ec32c0705",
        callback: "JSON_CALLBACK"
    }
    $scope.getRecipe = function (recipeId) {
        $http.jsonp("http://api.yummly.com/v1/api/recipe/" + recipeId + "?" + $.param(params))
        .success(function (response) {
            $scope.recipe = response;
        })
        .error(function (data) {
            $scope.errorMessage = data;
        });
    } 
    $scope.getRecipe(recipeId);
    // // don't make api call every time for now
    // var recipe = {"yield":"6 servings","nutritionEstimates":[{"attribute":"FAT_KCAL","description":null,"value":80.00,"unit":{"id":"fea252f8-9888-4365-b005-e2c63ed3a776","name":"calorie","abbreviation":"kcal","plural":"calories","pluralAbbreviation":"kcal","decimal":true}},{"attribute":"K","description":"Potassium, K","value":0.32,"unit":{"id":"12485d26-6e69-102c-9a8a-0030485841f8","name":"gram","abbreviation":"g","plural":"grams","pluralAbbreviation":"grams","decimal":true}},{"attribute":"FLD","description":"Fluoride, F","value":0.00,"unit":{"id":"12485d26-6e69-102c-9a8a-0030485841f8","name":"gram","abbreviation":"g","plural":"grams","pluralAbbreviation":"grams","decimal":true}},{"attribute":"PHYSTR","description":"Phytosterols","value":0.01,"unit":{"id":"12485d26-6e69-102c-9a8a-0030485841f8","name":"gram","abbreviation":"g","plural":"grams","pluralAbbreviation":"grams","decimal":true}},{"attribute":"VAL_G","description":"Valine","value":0.00,"unit":{"id":"12485d26-6e69-102c-9a8a-0030485841f8","name":"gram","abbreviation":"g","plural":"grams","pluralAbbreviation":"grams","decimal":true}},{"attribute":"SITSTR","description":"Beta-sitosterol","value":0.00,"unit":{"id":"12485d26-6e69-102c-9a8a-0030485841f8","name":"gram","abbreviation":"g","plural":"grams","pluralAbbreviation":"grams","decimal":true}},{"attribute":"F18D1C","description":"18:1 c","value":1.61,"unit":{"id":"12485d26-6e69-102c-9a8a-0030485841f8","name":"gram","abbreviation":"g","plural":"grams","pluralAbbreviation":"grams","decimal":true}},{"attribute":"F18D2CN6","description":"18:2 n-6 c,c","value":0.19,"unit":{"id":"12485d26-6e69-102c-9a8a-0030485841f8","name":"gram","abbreviation":"g","plural":"grams","pluralAbbreviation":"grams","decimal":true}},{"attribute":"FASAT","description":"Fatty acids, total saturated","value":4.83,"unit":{"id":"12485d26-6e69-102c-9a8a-0030485841f8","name":"gram","abbreviation":"g","plural":"grams","pluralAbbreviation":"grams","decimal":true}},{"attribute":"FOLDFE","description":"Folate, DFE","value":166.49,"unit":{"id":"4d783ee4-aa07-4958-84bf-3f4b528049dc","name":"mcg_DFE","abbreviation":"mcg_DFE","plural":"mcg_DFE","pluralAbbreviation":"mcg_DFE","decimal":false}},{"attribute":"MN","description":"Manganese, Mn","value":0.00,"unit":{"id":"12485d26-6e69-102c-9a8a-0030485841f8","name":"gram","abbreviation":"g","plural":"grams","pluralAbbreviation":"grams","decimal":true}},{"attribute":"F12D0","description":"12:0","value":0.28,"unit":{"id":"12485d26-6e69-102c-9a8a-0030485841f8","name":"gram","abbreviation":"g","plural":"grams","pluralAbbreviation":"grams","decimal":true}},{"attribute":"GLUS","description":"Glucose (dextrose)","value":1.47,"unit":{"id":"12485d26-6e69-102c-9a8a-0030485841f8","name":"gram","abbreviation":"g","plural":"grams","pluralAbbreviation":"grams","decimal":true}},{"attribute":"ARG_G","description":"Arginine","value":0.01,"unit":{"id":"12485d26-6e69-102c-9a8a-0030485841f8","name":"gram","abbreviation":"g","plural":"grams","pluralAbbreviation":"grams","decimal":true}},{"attribute":"F16D1","description":"16:1 undifferentiated","value":0.09,"unit":{"id":"12485d26-6e69-102c-9a8a-0030485841f8","name":"gram","abbreviation":"g","plural":"grams","pluralAbbreviation":"grams","decimal":true}},{"attribute":"F18D1T","description":"18:1 t","value":0.28,"unit":{"id":"12485d26-6e69-102c-9a8a-0030485841f8","name":"gram","abbreviation":"g","plural":"grams","pluralAbbreviation":"grams","decimal":true}},{"attribute":"FOLFD","description":"Folate, food","value":0.00,"unit":{"id":"12485d26-6e69-102c-9a8a-0030485841f8","name":"gram","abbreviation":"g","plural":"grams","pluralAbbreviation":"grams","decimal":true}},{"attribute":"FE","description":"Iron, Fe","value":0.00,"unit":{"id":"12485d26-6e69-102c-9a8a-0030485841f8","name":"gram","abbreviation":"g","plural":"grams","pluralAbbreviation":"grams","decimal":true}},{"attribute":"ENERC_KJ","description":"Energy","value":1254.06,"unit":{"id":"fea252f8-9888-4365-b005-e2c63ed3a776","name":"calorie","abbreviation":"kcal","plural":"calories","pluralAbbreviation":"kcal","decimal":true}},{"attribute":"VITB6A","description":"Vitamin B-6","value":0.00,"unit":{"id":"12485d26-6e69-102c-9a8a-0030485841f8","name":"gram","abbreviation":"g","plural":"grams","pluralAbbreviation":"grams","decimal":true}},{"attribute":"F4D0","description":"4:0","value":0.28,"unit":{"id":"12485d26-6e69-102c-9a8a-0030485841f8","name":"gram","abbreviation":"g","plural":"grams","pluralAbbreviation":"grams","decimal":true}},{"attribute":"ASP_G","description":"Aspartic acid","value":0.01,"unit":{"id":"12485d26-6e69-102c-9a8a-0030485841f8","name":"gram","abbreviation":"g","plural":"grams","pluralAbbreviation":"grams","decimal":true}},{"attribute":"FRUS","description":"Fructose","value":0.73,"unit":{"id":"12485d26-6e69-102c-9a8a-0030485841f8","name":"gram","abbreviation":"g","plural":"grams","pluralAbbreviation":"grams","decimal":true}},{"attribute":"TOCPHA","description":"Vitamin E (alpha-tocopherol)","value":0.00,"unit":{"id":"12485d26-6e69-102c-9a8a-0030485841f8","name":"gram","abbreviation":"g","plural":"grams","pluralAbbreviation":"grams","decimal":true}},{"attribute":"WATER","description":"Water","value":319.92,"unit":{"id":"12485d26-6e69-102c-9a8a-0030485841f8","name":"gram","abbreviation":"g","plural":"grams","pluralAbbreviation":"grams","decimal":true}},{"attribute":"F8D0","description":"8:0","value":0.09,"unit":{"id":"12485d26-6e69-102c-9a8a-0030485841f8","name":"gram","abbreviation":"g","plural":"grams","pluralAbbreviation":"grams","decimal":true}},{"attribute":"RETOL","description":"Retinol","value":0.00,"unit":{"id":"12485d26-6e69-102c-9a8a-0030485841f8","name":"gram","abbreviation":"g","plural":"grams","pluralAbbreviation":"grams","decimal":true}},{"attribute":"SUGAR","description":"Sugars, total","value":4.86,"unit":{"id":"12485d26-6e69-102c-9a8a-0030485841f8","name":"gram","abbreviation":"g","plural":"grams","pluralAbbreviation":"grams","decimal":true}},{"attribute":"F6D0","description":"6:0","value":0.19,"unit":{"id":"12485d26-6e69-102c-9a8a-0030485841f8","name":"gram","abbreviation":"g","plural":"grams","pluralAbbreviation":"grams","decimal":true}},{"attribute":"FAMS","description":"Fatty acids, total monounsaturated","value":1.99,"unit":{"id":"12485d26-6e69-102c-9a8a-0030485841f8","name":"gram","abbreviation":"g","plural":"grams","pluralAbbreviation":"grams","decimal":true}},{"attribute":"GLY_G","description":"Glycine","value":0.00,"unit":{"id":"12485d26-6e69-102c-9a8a-0030485841f8","name":"gram","abbreviation":"g","plural":"grams","pluralAbbreviation":"grams","decimal":true}},{"attribute":"ASH","description":"Ash","value":3.88,"unit":{"id":"12485d26-6e69-102c-9a8a-0030485841f8","name":"gram","abbreviation":"g","plural":"grams","pluralAbbreviation":"grams","decimal":true}},{"attribute":"SE","description":"Selenium, Se","value":0.00,"unit":{"id":"12485d26-6e69-102c-9a8a-0030485841f8","name":"gram","abbreviation":"g","plural":"grams","pluralAbbreviation":"grams","decimal":true}},{"attribute":"FIBTG","description":"Fiber, total dietary","value":2.79,"unit":{"id":"12485d26-6e69-102c-9a8a-0030485841f8","name":"gram","abbreviation":"g","plural":"grams","pluralAbbreviation":"grams","decimal":true}},{"attribute":"PROCNT","description":"Protein","value":10.96,"unit":{"id":"12485d26-6e69-102c-9a8a-0030485841f8","name":"gram","abbreviation":"g","plural":"grams","pluralAbbreviation":"grams","decimal":true}},{"attribute":"PHE_G","description":"Phenylalanine","value":0.00,"unit":{"id":"12485d26-6e69-102c-9a8a-0030485841f8","name":"gram","abbreviation":"g","plural":"grams","pluralAbbreviation":"grams","decimal":true}},{"attribute":"CHOCDF","description":"Carbohydrate, by difference","value":42.69,"unit":{"id":"12485d26-6e69-102c-9a8a-0030485841f8","name":"gram","abbreviation":"g","plural":"grams","pluralAbbreviation":"grams","decimal":true}},{"attribute":"FOL","description":"Folate, total","value":0.00,"unit":{"id":"12485d26-6e69-102c-9a8a-0030485841f8","name":"gram","abbreviation":"g","plural":"grams","pluralAbbreviation":"grams","decimal":true}},{"attribute":"VITK","description":"Vitamin K (phylloquinone)","value":0.00,"unit":{"id":"12485d26-6e69-102c-9a8a-0030485841f8","name":"gram","abbreviation":"g","plural":"grams","pluralAbbreviation":"grams","decimal":true}},{"attribute":"F18D0","description":"18:0","value":0.95,"unit":{"id":"12485d26-6e69-102c-9a8a-0030485841f8","name":"gram","abbreviation":"g","plural":"grams","pluralAbbreviation":"grams","decimal":true}},{"attribute":"LEU_G","description":"Leucine","value":0.64,"unit":{"id":"12485d26-6e69-102c-9a8a-0030485841f8","name":"gram","abbreviation":"g","plural":"grams","pluralAbbreviation":"grams","decimal":true}},{"attribute":"LUT+ZEA","description":"Lutein + zeaxanthin","value":0.00,"unit":{"id":"12485d26-6e69-102c-9a8a-0030485841f8","name":"gram","abbreviation":"g","plural":"grams","pluralAbbreviation":"grams","decimal":true}},{"attribute":"CHOLE","description":"Cholesterol","value":0.02,"unit":{"id":"12485d26-6e69-102c-9a8a-0030485841f8","name":"gram","abbreviation":"g","plural":"grams","pluralAbbreviation":"grams","decimal":true}},{"attribute":"F17D0","description":"17:0","value":0.09,"unit":{"id":"12485d26-6e69-102c-9a8a-0030485841f8","name":"gram","abbreviation":"g","plural":"grams","pluralAbbreviation":"grams","decimal":true}},{"attribute":"CU","description":"Copper, Cu","value":0.00,"unit":{"id":"12485d26-6e69-102c-9a8a-0030485841f8","name":"gram","abbreviation":"g","plural":"grams","pluralAbbreviation":"grams","decimal":true}},{"attribute":"P","description":"Phosphorus, P","value":0.13,"unit":{"id":"12485d26-6e69-102c-9a8a-0030485841f8","name":"gram","abbreviation":"g","plural":"grams","pluralAbbreviation":"grams","decimal":true}},{"attribute":"PANTAC","description":"Pantothenic acid","value":0.00,"unit":{"id":"12485d26-6e69-102c-9a8a-0030485841f8","name":"gram","abbreviation":"g","plural":"grams","pluralAbbreviation":"grams","decimal":true}},{"attribute":"CHOLN","description":"Choline, total","value":0.02,"unit":{"id":"12485d26-6e69-102c-9a8a-0030485841f8","name":"gram","abbreviation":"g","plural":"grams","pluralAbbreviation":"grams","decimal":true}},{"attribute":"F10D0","description":"10:0","value":0.28,"unit":{"id":"12485d26-6e69-102c-9a8a-0030485841f8","name":"gram","abbreviation":"g","plural":"grams","pluralAbbreviation":"grams","decimal":true}},{"attribute":"CA","description":"Calcium, Ca","value":0.06,"unit":{"id":"12485d26-6e69-102c-9a8a-0030485841f8","name":"gram","abbreviation":"g","plural":"grams","pluralAbbreviation":"grams","decimal":true}},{"attribute":"MG","description":"Magnesium, Mg","value":0.03,"unit":{"id":"12485d26-6e69-102c-9a8a-0030485841f8","name":"gram","abbreviation":"g","plural":"grams","pluralAbbreviation":"grams","decimal":true}},{"attribute":"FAPU","description":"Fatty acids, total polyunsaturated","value":0.93,"unit":{"id":"12485d26-6e69-102c-9a8a-0030485841f8","name":"gram","abbreviation":"g","plural":"grams","pluralAbbreviation":"grams","decimal":true}},{"attribute":"F14D0","description":"14:0","value":0.66,"unit":{"id":"12485d26-6e69-102c-9a8a-0030485841f8","name":"gram","abbreviation":"g","plural":"grams","pluralAbbreviation":"grams","decimal":true}},{"attribute":"VITA_RAE","description":"Vitamin A, RAE","value":64.95,"unit":{"id":"0fcf76b3-891a-403d-883f-58c8809ef151","name":"mcg_RAE","abbreviation":"mcg_RAE","plural":"mcg_RAE","pluralAbbreviation":"mcg_RAE","decimal":false}},{"attribute":"NIA","description":"Niacin","value":0.01,"unit":{"id":"12485d26-6e69-102c-9a8a-0030485841f8","name":"gram","abbreviation":"g","plural":"grams","pluralAbbreviation":"grams","decimal":true}},{"attribute":"GLU_G","description":"Glutamic acid","value":1.93,"unit":{"id":"12485d26-6e69-102c-9a8a-0030485841f8","name":"gram","abbreviation":"g","plural":"grams","pluralAbbreviation":"grams","decimal":true}},{"attribute":"F16D0","description":"16:0","value":2.08,"unit":{"id":"12485d26-6e69-102c-9a8a-0030485841f8","name":"gram","abbreviation":"g","plural":"grams","pluralAbbreviation":"grams","decimal":true}},{"attribute":"F18D1","description":"18:1 undifferentiated","value":1.89,"unit":{"id":"12485d26-6e69-102c-9a8a-0030485841f8","name":"gram","abbreviation":"g","plural":"grams","pluralAbbreviation":"grams","decimal":true}},{"attribute":"F18D2","description":"18:2 undifferentiated","value":0.92,"unit":{"id":"12485d26-6e69-102c-9a8a-0030485841f8","name":"gram","abbreviation":"g","plural":"grams","pluralAbbreviation":"grams","decimal":true}},{"attribute":"BETN","description":"Betaine","value":0.04,"unit":{"id":"12485d26-6e69-102c-9a8a-0030485841f8","name":"gram","abbreviation":"g","plural":"grams","pluralAbbreviation":"grams","decimal":true}},{"attribute":"FOLAC","description":"Folic acid","value":0.00,"unit":{"id":"12485d26-6e69-102c-9a8a-0030485841f8","name":"gram","abbreviation":"g","plural":"grams","pluralAbbreviation":"grams","decimal":true}},{"attribute":"SUCS","description":"Sucrose","value":0.74,"unit":{"id":"12485d26-6e69-102c-9a8a-0030485841f8","name":"gram","abbreviation":"g","plural":"grams","pluralAbbreviation":"grams","decimal":true}},{"attribute":"CARTB","description":"Carotene, beta","value":0.00,"unit":{"id":"12485d26-6e69-102c-9a8a-0030485841f8","name":"gram","abbreviation":"g","plural":"grams","pluralAbbreviation":"grams","decimal":true}},{"attribute":"LYS_G","description":"Lysine","value":0.00,"unit":{"id":"12485d26-6e69-102c-9a8a-0030485841f8","name":"gram","abbreviation":"g","plural":"grams","pluralAbbreviation":"grams","decimal":true}},{"attribute":"F16D1C","description":"16:1 c","value":0.09,"unit":{"id":"12485d26-6e69-102c-9a8a-0030485841f8","name":"gram","abbreviation":"g","plural":"grams","pluralAbbreviation":"grams","decimal":true}},{"attribute":"F18D3","description":"18:3 undifferentiated","value":0.00,"unit":{"id":"12485d26-6e69-102c-9a8a-0030485841f8","name":"gram","abbreviation":"g","plural":"grams","pluralAbbreviation":"grams","decimal":true}},{"attribute":"SER_G","description":"Serine","value":0.00,"unit":{"id":"12485d26-6e69-102c-9a8a-0030485841f8","name":"gram","abbreviation":"g","plural":"grams","pluralAbbreviation":"grams","decimal":true}},{"attribute":"VITA_IU","description":"Vitamin A, IU","value":242.98,"unit":{"id":"ed46fe0c-44fe-4c1f-b3a8-880f92e30930","name":"IU","abbreviation":"IU","plural":"IU","pluralAbbreviation":"IU","decimal":true}},{"attribute":"ENERC_KCAL","description":"Energy","value":300.03,"unit":{"id":"fea252f8-9888-4365-b005-e2c63ed3a776","name":"calorie","abbreviation":"kcal","plural":"calories","pluralAbbreviation":"kcal","decimal":true}},{"attribute":"VITC","description":"Vitamin C, total ascorbic acid","value":0.01,"unit":{"id":"12485d26-6e69-102c-9a8a-0030485841f8","name":"gram","abbreviation":"g","plural":"grams","pluralAbbreviation":"grams","decimal":true}},{"attribute":"FAT","description":"Total lipid (fat)","value":8.95,"unit":{"id":"12485d26-6e69-102c-9a8a-0030485841f8","name":"gram","abbreviation":"g","plural":"grams","pluralAbbreviation":"grams","decimal":true}},{"attribute":"PRO_G","description":"Proline","value":0.64,"unit":{"id":"12485d26-6e69-102c-9a8a-0030485841f8","name":"gram","abbreviation":"g","plural":"grams","pluralAbbreviation":"grams","decimal":true}},{"attribute":"VITD-","description":"Vitamin D","value":5.68,"unit":{"id":"ed46fe0c-44fe-4c1f-b3a8-880f92e30930","name":"IU","abbreviation":"IU","plural":"IU","pluralAbbreviation":"IU","decimal":true}},{"attribute":"ZN","description":"Zinc, Zn","value":0.00,"unit":{"id":"12485d26-6e69-102c-9a8a-0030485841f8","name":"gram","abbreviation":"g","plural":"grams","pluralAbbreviation":"grams","decimal":true}},{"attribute":"NA","description":"Sodium, Na","value":1.26,"unit":{"id":"12485d26-6e69-102c-9a8a-0030485841f8","name":"gram","abbreviation":"g","plural":"grams","pluralAbbreviation":"grams","decimal":true}}],"totalTime":"1 hr 30 min","images":[{"imageUrlsBySize":{"90":"http://lh3.googleusercontent.com/y3vyE83UJ6kS3JrmL0QMmMwyqkWaYhpAch8H9LSvqOlNShCfwfU9HW5EcgiCUHdnDUPTQd4BROIlT4TVrzoY3w=s90-c","360":"http://lh3.googleusercontent.com/y3vyE83UJ6kS3JrmL0QMmMwyqkWaYhpAch8H9LSvqOlNShCfwfU9HW5EcgiCUHdnDUPTQd4BROIlT4TVrzoY3w=s360-c"},"hostedSmallUrl":"http://lh3.googleusercontent.com/E6SuZPtnddAfybTDoT5hBjVj0cRX4GgLfS8LsF6Kk9RLbxL6uwPWFuOIczk9NM_d8iz-81-R2p-uzMui7qrDJn0=s90","hostedMediumUrl":"http://lh3.googleusercontent.com/E6SuZPtnddAfybTDoT5hBjVj0cRX4GgLfS8LsF6Kk9RLbxL6uwPWFuOIczk9NM_d8iz-81-R2p-uzMui7qrDJn0=s180","hostedLargeUrl":"http://lh3.googleusercontent.com/E6SuZPtnddAfybTDoT5hBjVj0cRX4GgLfS8LsF6Kk9RLbxL6uwPWFuOIczk9NM_d8iz-81-R2p-uzMui7qrDJn0=s360"}],"name":"French Onion Soup","source":{"sourceRecipeUrl":"http://www.pumpkinnspice.com/2015/04/01/french-onion-soup/","sourceSiteUrl":"pumpkinnspice.com","sourceDisplayName":"Pumpkin N Spice"},"id":"French-Onion-Soup-1057922","ingredientLines":["4 yellow onions, sliced into thin strips","1/4 cup butter","6 cups beef broth","1/2 teaspoon garlic powder","1 bay leaf","6 slices of french bread","6 slices Gruyere or Swiss cheese"],"attribution":{"html":"<a href='http://www.yummly.com/recipe/French-Onion-Soup-1057922'>French Onion Soup recipe</a> information powered by <img alt='Yummly' src='http://static.yummly.com/api-logo.png'/>","url":"http://www.yummly.com/recipe/French-Onion-Soup-1057922","text":"French Onion Soup recipes: information powered by Yummly","logo":"http://static.yummly.com/api-logo.png"},"numberOfServings":6,"totalTimeInSeconds":5400,"attributes":{"cuisine":["French"],"course":["Soups"]},"flavors":{},"rating":4};
    // console.log(recipe)
    // $scope.recipe = recipe;

    $scope.refreshReviews = function()
    {
        $http.get("/reviewsByRecipe/" + recipeId)
        .success( function(res) {
            $scope.reviews = res;
        });
    }

    //initial load of reviews
    $scope.refreshReviews();

    $scope.saveReview = function(review)
    {
        if (!review) {
            $scope.errorMessage = "Please write a review before submitting."
        } else {
            review.username = $scope.user.username;
            review.recipeId = $scope.recipe.id;
            review.recipeName = $scope.recipe.name;
            $http.post('/review', review)
            .success(function(response) {
                $scope.refreshReviews();
                $scope.hideReivewForm();
            })
            .error(function(data) {
                $scope.errorMessage = data;
            });
        }
    }

    $scope.hideReivewForm = function()
    {
        var reviewForm = $("#review-form");
        reviewForm.hide();
        $scope.errorMessage = ""
        $scope.successMessage = "Thank you for submitting a review."
    }
});
